using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using System.Globalization;

namespace PSLogging {
    public class Logfile {

        protected TextWriter textWriter;
        protected readonly Object syncObject; //= new Object();  //static
        protected string path = null;

        public string Path {
            get { return this.path; }
        }

        public Logfile(string path) {
            if(path.Contains("\\")) {
                string directory = path.Substring(0, path.LastIndexOf("\\"));
                if(!Directory.Exists(directory)) {
                    Directory.CreateDirectory(directory);
                }
            }

            this.path = path;
            this.syncObject = new Object();
            this.textWriter = TextWriter.Synchronized(File.AppendText(this.path));
        }

        public virtual void Write(string message) {
            string datetimeString = DateTime.Now.ToString(CultureInfo.InvariantCulture);
            lock(syncObject) {
                this.textWriter.WriteLine(datetimeString + " " + message);
                this.textWriter.Flush();
            }
        }
        /*
        public void Write(string message) {
            DateTime time = DateTime.Now;
            File.AppendAllText(this.path, time.ToString(CultureInfo.InvariantCulture) + " " + message + Environment.NewLine);
        }*/
    }
}
